#!/bin/bash

# Launch the wolfssl server in the background
cd ${HOME}/wolfssl-asan/
${HOME}/wolfssl-asan/examples/server/server -c ${HOME}/test.fullchain.pem \
        -k ${HOME}/test.key.pem \
        -e -p 4433 &

# Store the server's PID
SERVER_PID=$!

# Wait a moment for the server to start
sleep 2

# Check if server is running
if ! kill -0 $SERVER_PID 2>/dev/null; then
    echo "Server failed to start"
    exit 1
fi

echo "Starting mal-client..."
# Launch the mal_client in the foreground
LD_LIBRARY_PATH=${HOME}/wolfssl/src/.libs ${HOME}/mal-client

# Clean up the server process when done
kill $SERVER_PID
