# CVE-2022-35409

ClientHello 中 cookie 的长度超出消息边界

An unauthenticated remote host can send an invalid ClientHello message in which the declared length of the cookie extends past the end of the message. A DTLS server with MBEDTLS_SSL_DTLS_CLIENT_PORT_REUSE enabled will read past the end of the message up to the declared length of the cookie.

At this point in the parsing, the message is stored in a buffer with room for MBEDTLS_SSL_IN_CONTENT_LEN bytes plus headers. The data beyond the end of the message has been wiped, so there is no risk of information disclosure from the buffer. Therefore this is a vulnerability only if the purported length of the cookie extends beyond the end of the buffer.

Since the length of the cookie is limited to 255 bytes, the vulnerability is only present if MBEDTLS_SSL_IN_CONTENT_LEN is small. The threshold depends on the exact configuration. The default value of MBEDTLS_SSL_IN_CONTENT_LEN is large enough to avoid the vulnerability.

The default cookie check function mbedtls_ssl_cookie_check() does not read the cookie if its length is not the expected length (28 bytes if SHA-256 is enabled).